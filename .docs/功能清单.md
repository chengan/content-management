# 微信内容管理系统 - 循序渐进开发方案

## 🎯 项目概述

**系统目标：** 打造一个从热门内容采集到AI改写再到公众号发布的完整内容管理流程

**技术架构：** Next.js前后端一体化 + Supabase数据库 + OpenRouter AI + 今日热榜API

**用户定位：** 单用户内容创作者，无需复杂的权限管理

## 📈 循序渐进开发计划

### 🔥 第一阶段：基础数据管理
**开发时间：** 2-3天  
**核心价值：** 建立数据基础，替换模拟数据，可以手动管理内容

#### 📋 功能清单
- ✅ Supabase数据库搭建和配置
- ✅ 文章素材的增删改查功能
- ✅ 数据验证和错误处理
- ✅ 前端页面连接真实API

#### 🔧 开发接口 (5个)
```typescript
GET    /api/materials              // 获取素材列表 (支持分页、筛选、搜索)
GET    /api/materials/{id}         // 获取单个素材详情
PUT    /api/materials/{id}         // 更新素材信息
DELETE /api/materials/{id}         // 删除素材
POST   /api/materials/batch        // 批量操作素材 (删除、状态更新)
```

#### 🗄️ 数据库表设计
```sql
-- articles 表 (文章素材表)
CREATE TABLE articles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(500) NOT NULL,
  content TEXT NOT NULL,
  source VARCHAR(100) NOT NULL,
  source_url VARCHAR(500),
  author VARCHAR(100),
  publish_time TIMESTAMP,
  collect_time TIMESTAMP DEFAULT NOW(),
  tags TEXT[] DEFAULT '{}',
  category VARCHAR(50),
  read_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'rewritten', 'published')),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_articles_status ON articles(status);
CREATE INDEX idx_articles_category ON articles(category);
CREATE INDEX idx_articles_collect_time ON articles(collect_time);
```

#### 🎯 用户体验
- ✅ 替换掉现有的模拟数据，使用真实数据库
- ✅ 可以手动添加、编辑、删除文章
- ✅ 支持按状态、分类筛选文章
- ✅ 支持关键词搜索功能

---

### ⚡ 第二阶段：自动化内容采集
**开发时间：** 3-4天  
**核心价值：** 自动获取热门内容，解放双手，不用手动寻找文章

#### 📋 功能清单
- ✅ 今日热榜API集成
- ✅ 多平台热门内容获取 (知乎、微博、百度等)
- ✅ 采集历史记录和统计
- ✅ 定时采集任务设置
- ✅ 内容去重和质量筛选

#### 🔧 开发接口 (5个)
```typescript
GET  /api/collect/sources          // 获取可采集的平台列表
GET  /api/collect/hotlist          // 获取实时热榜内容
POST /api/collect/articles         // 手动采集指定文章
GET  /api/collect/history          // 查看采集历史记录
POST /api/collect/schedule         // 设置自动采集时间
```

#### 🗄️ 数据库扩展
```sql
-- collect_sources 表 (采集源配置表)
CREATE TABLE collect_sources (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  platform VARCHAR(50) NOT NULL,
  api_endpoint VARCHAR(500),
  hash_id VARCHAR(100),
  is_active BOOLEAN DEFAULT true,
  config JSONB DEFAULT '{}',
  created_at TIMESTAMP DEFAULT NOW()
);

-- collect_history 表 (采集历史表)  
CREATE TABLE collect_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  source_id UUID REFERENCES collect_sources(id),
  articles_count INTEGER DEFAULT 0,
  success_count INTEGER DEFAULT 0,
  collected_at TIMESTAMP DEFAULT NOW()
);
```

#### 🎯 用户体验
- ✅ 一键获取各大平台实时热门内容
- ✅ 支持手动选择性采集感兴趣的文章
- ✅ 自动定时采集，无需手动操作
- ✅ 查看采集历史和成功率统计

---

### 🤖 第三阶段：AI智能改写
**开发时间：** 2-3天  
**核心价值：** AI帮你重写内容，避免原创问题，提升内容质量

#### 📋 功能清单
- ✅ OpenRouter AI接口集成
- ✅ 多种改写风格支持 (专业、亲民、营销、通用)
- ✅ 自定义改写提示词
- ✅ 改写历史记录和对比
- ✅ 批量改写功能

#### 🔧 开发接口 (4个)
```typescript
POST /api/rewrite/generate         // AI改写文章内容
GET  /api/rewrite/history          // 获取改写历史记录
GET  /api/rewrite/styles           // 获取改写风格列表
POST /api/rewrite/custom-style     // 添加自定义改写风格
```

#### 🗄️ 数据库扩展
```sql
-- rewrite_records 表 (改写记录表)
CREATE TABLE rewrite_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  article_id UUID REFERENCES articles(id) ON DELETE CASCADE,
  original_title VARCHAR(500) NOT NULL,
  rewritten_title VARCHAR(500) NOT NULL,
  original_content TEXT NOT NULL,
  rewritten_content TEXT NOT NULL,
  style VARCHAR(50) NOT NULL,
  custom_prompt TEXT,
  ai_model VARCHAR(100),
  created_at TIMESTAMP DEFAULT NOW()
);

-- rewrite_styles 表 (改写风格表)
CREATE TABLE rewrite_styles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  prompt TEXT NOT NULL,
  is_default BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 🎯 用户体验
- ✅ 选择文章一键AI改写，支持多种风格
- ✅ 可以自定义改写提示词，个性化改写
- ✅ 查看改写前后对比，选择满意的版本
- ✅ 保存改写历史，方便回顾和复用

---

### 🎨 第四阶段：智能配图生成
**开发时间：** 3-4天  
**核心价值：** AI生成匹配图片，提升内容视觉效果

#### 📋 功能清单
- ✅ AI图片生成接口集成 (预留，待提供具体API)
- ✅ 基于文章内容关键词生成配图
- ✅ 图片库管理和分类
- ✅ 图片上传和编辑功能
- ✅ 图片与文章关联管理

#### 🔧 开发接口 (4个)
```typescript
POST /api/images/generate          // AI生成文章配图
GET  /api/images/library           // 获取图片库
POST /api/images/upload            // 手动上传图片
DELETE /api/images/{id}            // 删除图片
```

#### 🗄️ 数据库扩展
```sql
-- images 表 (图片库表)
CREATE TABLE images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  filename VARCHAR(255) NOT NULL,
  original_name VARCHAR(255),
  url VARCHAR(500) NOT NULL,
  alt_text VARCHAR(255),
  file_size INTEGER,
  width INTEGER,
  height INTEGER,
  article_id UUID REFERENCES articles(id),
  category VARCHAR(50),
  tags TEXT[] DEFAULT '{}',
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 🎯 用户体验
- ✅ 根据文章标题和内容自动生成匹配配图
- ✅ 管理图片库，支持分类和标签
- ✅ 支持手动上传自定义图片
- ✅ 图片与文章智能关联，重复使用

---

### 🚀 第五阶段：发布管理系统
**开发时间：** 2-3天  
**核心价值：** 预览和管理发布内容，完成整个创作流程

#### 📋 功能清单
- ✅ 发布内容预览功能
- ✅ 公众号账号管理
- ✅ 发布记录和状态跟踪
- ✅ 发布数据统计分析
- ✅ 微信公众号API预留接口

#### 🔧 开发接口 (3个)
```typescript
GET  /api/publish/accounts         // 获取公众号账号列表
POST /api/publish/preview          // 预览发布内容
POST /api/publish/submit           // 提交发布 (当前阶段仅记录)
```

#### 🗄️ 数据库扩展
```sql
-- wechat_accounts 表 (微信公众号账号表)
CREATE TABLE wechat_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  avatar VARCHAR(500),
  app_id VARCHAR(100),
  access_token TEXT,
  refresh_token TEXT,
  is_connected BOOLEAN DEFAULT false,
  last_sync TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- publication_records 表 (发布记录表)
CREATE TABLE publication_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  article_id UUID REFERENCES articles(id),
  account_id UUID REFERENCES wechat_accounts(id),
  title VARCHAR(500) NOT NULL,
  content TEXT NOT NULL,
  images TEXT[] DEFAULT '{}',
  published_at TIMESTAMP,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'success', 'failed')),
  stats JSONB DEFAULT '{}',
  error_message TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 🎯 用户体验
- ✅ 预览最终发布效果，确认无误后发布
- ✅ 管理多个公众号账号
- ✅ 查看发布历史和数据统计
- ✅ 发布状态实时跟踪

---

## 🛠️ 技术实施细节

### 🔧 开发环境配置
```bash
# 安装必要依赖
pnpm add @supabase/supabase-js    # Supabase客户端
pnpm add axios                    # HTTP请求库
pnpm add uuid                     # UUID生成
pnpm add @types/uuid              # UUID类型定义
```

### 🌍 环境变量配置
```env
# Supabase配置
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# OpenRouter AI配置
OPENROUTER_API_KEY=your-openrouter-api-key

# 今日热榜API配置
TOPHUB_ACCESS_KEY=your-tophub-access-key

# 图片生成API配置 (待添加)
IMAGE_GENERATION_API_KEY=your-image-api-key
```

### 📁 项目结构扩展
```
app/
├── api/
│   ├── materials/           # 素材管理API
│   ├── collect/            # 内容采集API  
│   ├── rewrite/            # AI改写API
│   ├── images/             # 图片管理API
│   └── publish/            # 发布管理API
├── lib/
│   ├── supabase.ts         # Supabase客户端
│   ├── openrouter.ts       # OpenRouter客户端
│   ├── tophub.ts           # 今日热榜客户端
│   └── types.ts            # API类型定义
```

## 📊 开发进度追踪

### ✅ 完成标准
- [ ] **第一阶段** - 可以在真实数据库中管理文章
- [ ] **第二阶段** - 可以自动采集各平台热门内容
- [ ] **第三阶段** - 可以使用AI改写文章内容
- [ ] **第四阶段** - 可以生成和管理文章配图
- [ ] **第五阶段** - 可以预览和记录发布内容

### 🚀 最终交付
**完整功能：** 21个API接口，5个功能模块，端到端的内容创作流程

**系统能力：** 
- 自动采集热门内容
- AI智能改写文章
- 自动生成匹配配图
- 一键发布到公众号
- 完整的数据管理和统计

---

## 🎯 下一步行动

**立即开始：** 第一阶段 - 基础数据管理
1. 配置Supabase数据库
2. 创建articles表
3. 开发5个素材管理API接口
4. 前端页面连接真实API

**预计时间：** 2-3天完成第一阶段，你就可以开始使用真实的数据管理功能了！

---

*这个循序渐进的方案确保每个阶段都有实际可用的功能，让你在学习过程中不断看到进展，最终实现完整的内容管理系统。*